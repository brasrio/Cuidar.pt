<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Cuidar.pt</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <style>
        .admin-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .admin-section h2 {
            color: #1e3a5f;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .user-card {
            background: #f8f9fa;
            border-left: 4px solid #1e5ede;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .user-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .user-card.admin-card {
            border-left-color: #9b59b6;
            background: linear-gradient(135deg, #f5f3ff 0%, #fff 100%);
        }
        
        .user-card.cuidador-card {
            border-left-color: #3abebd;
            background: linear-gradient(135deg, #e8f8f8 0%, #fff 100%);
        }
        
        .user-card.cliente-card {
            border-left-color: #f39c12;
            background: linear-gradient(135deg, #fff9e6 0%, #fff 100%);
        }
        
        .user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .user-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #1e3a5f;
        }
        
        .user-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .badge-admin {
            background: #9b59b6;
            color: white;
        }
        
        .badge-cuidador {
            background: #3abebd;
            color: white;
        }
        
        .badge-cliente {
            background: #f39c12;
            color: white;
        }
        
        .user-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #5a7184;
        }
        
        .info-item strong {
            color: #1e3a5f;
        }
        
        .user-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .btn-action {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-view {
            background: #3498db;
            color: white;
        }
        
        .btn-view:hover {
            background: #2980b9;
        }
        
        .btn-edit {
            background: #27ae60;
            color: white;
        }
        
        .btn-edit:hover {
            background: #229954;
        }
        
        .btn-disable {
            background: #e74c3c;
            color: white;
        }
        
        .btn-disable:hover {
            background: #c0392b;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1e5ede;
        }
        
        .stat-label {
            color: #5a7184;
            margin-top: 0.5rem;
        }
        
        .loading {
            text-align: center;
            padding: 3rem;
            color: #5a7184;
        }
        
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #5a7184;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .count-badge {
            background: #1e5ede;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar container">
            <a href="index.html" class="navbar-brand">
                <img src="assets/images/logo.svg" alt="Cuidar.pt Logo" class="navbar-logo">
                <span class="navbar-title">Cuidar.pt</span>
            </a>
            
            <button class="navbar-toggle" aria-label="Menu">
                <span class="navbar-toggle-icon"></span>
                <span class="navbar-toggle-icon"></span>
                <span class="navbar-toggle-icon"></span>
            </button>
            
            <ul class="navbar-menu">
                <li><a href="dashboard.html" class="navbar-link">Dashboard</a></li>
                <li><a href="dashboard-admin.html" class="navbar-link">Gerenciar Usu√°rios</a></li>
                <li><button onclick="logout()" class="btn-logout" style="border: none;">Sair</button></li>
            </ul>
        </nav>
    </header>

    <!-- Dashboard Content -->
    <section class="dashboard">
        <div class="dashboard-container">
            <h1 style="color: #1e3a5f; margin-bottom: 2rem;">üëë Painel Administrativo</h1>
            
            <!-- Estat√≠sticas -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalUsuarios">0</div>
                    <div class="stat-label">Total de Usu√°rios</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalAdmins">0</div>
                    <div class="stat-label">Administradores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalCuidadores">0</div>
                    <div class="stat-label">Cuidadores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalClientes">0</div>
                    <div class="stat-label">Clientes</div>
                </div>
            </div>
            
            <!-- Loading -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Carregando usu√°rios...</p>
            </div>
            
            <!-- Administradores -->
            <div id="adminsSection" class="admin-section" style="display: none;">
                <div class="section-header">
                    <h2>üëë Administradores</h2>
                    <span class="count-badge" id="adminCount">0</span>
                </div>
                <div id="adminsList"></div>
            </div>
            
            <!-- Cuidadores -->
            <div id="cuidadoresSection" class="admin-section" style="display: none;">
                <div class="section-header">
                    <h2>üë®‚Äç‚öïÔ∏è Cuidadores Profissionais</h2>
                    <span class="count-badge" id="cuidadorCount">0</span>
                </div>
                <div id="cuidadoresList"></div>
            </div>
            
            <!-- Clientes -->
            <div id="clientesSection" class="admin-section" style="display: none;">
                <div class="section-header">
                    <h2>üë§ Clientes / Fam√≠lias</h2>
                    <span class="count-badge" id="clienteCount">0</span>
                </div>
                <div id="clientesList"></div>
            </div>
        </div>
    </section>

    <script src="js/main.js"></script>
    <script>
        const API_URL = 'http://localhost:3000/api';
        
        /**
         * Logout
         */
        function logout() {
            localStorage.clear();
            window.location.href = 'login.html';
        }
        
        /**
         * Verifica se √© admin
         */
        function verificarAdmin() {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            if (user.role !== 'admin' && user.userType !== 'admin') {
                alert('Acesso negado! Apenas administradores.');
                window.location.href = 'dashboard.html';
                return false;
            }
            return true;
        }
        
        /**
         * Carrega todos os usu√°rios
         */
        async function carregarUsuarios() {
            if (!verificarAdmin()) return;
            
            const user = JSON.parse(localStorage.getItem('user'));
            
            try {
                const response = await fetch(`${API_URL}/users`, {
                    headers: {
                        'x-user-id': user.id
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    organizarUsuarios(data.users);
                } else {
                    alert('Erro: ' + data.message);
                }
            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('loading').innerHTML = 
                    '<p style="color: #e74c3c;">‚ùå Erro ao carregar usu√°rios. Verifique se o servidor est√° rodando.</p>';
            }
        }
        
        /**
         * Organiza usu√°rios por tipo
         */
        function organizarUsuarios(users) {
            const admins = users.filter(u => u.role === 'admin' || u.userType === 'admin');
            const cuidadores = users.filter(u => u.role === 'cuidador' || u.userType === 'cuidador');
            const clientes = users.filter(u => (u.role === 'cliente' || u.userType === 'familia') && u.role !== 'admin' && u.userType !== 'admin' && u.role !== 'cuidador' && u.userType !== 'cuidador');
            
            // Atualiza estat√≠sticas
            document.getElementById('totalUsuarios').textContent = users.length;
            document.getElementById('totalAdmins').textContent = admins.length;
            document.getElementById('totalCuidadores').textContent = cuidadores.length;
            document.getElementById('totalClientes').textContent = clientes.length;
            
            // Esconde loading
            document.getElementById('loading').style.display = 'none';
            
            // Renderiza listas
            if (admins.length > 0) {
                document.getElementById('adminsSection').style.display = 'block';
                document.getElementById('adminCount').textContent = admins.length;
                document.getElementById('adminsList').innerHTML = admins.map(u => criarCardUsuario(u, 'admin')).join('');
            }
            
            if (cuidadores.length > 0) {
                document.getElementById('cuidadoresSection').style.display = 'block';
                document.getElementById('cuidadorCount').textContent = cuidadores.length;
                document.getElementById('cuidadoresList').innerHTML = cuidadores.map(u => criarCardUsuario(u, 'cuidador')).join('');
            }
            
            if (clientes.length > 0) {
                document.getElementById('clientesSection').style.display = 'block';
                document.getElementById('clienteCount').textContent = clientes.length;
                document.getElementById('clientesList').innerHTML = clientes.map(u => criarCardUsuario(u, 'cliente')).join('');
            }
        }
        
        /**
         * Cria card de usu√°rio
         */
        function criarCardUsuario(user, tipo) {
            const badges = {
                admin: '<span class="user-badge badge-admin">üëë Admin</span>',
                cuidador: '<span class="user-badge badge-cuidador">üë®‚Äç‚öïÔ∏è Cuidador</span>',
                cliente: '<span class="user-badge badge-cliente">üë§ Cliente</span>'
            };
            
            const dataFormatada = user.createdAt ? 
                new Date(user.createdAt).toLocaleDateString('pt-BR') : 'N/A';
            
            const cidadeCompleta = user.distrito && user.cidade ?
                `${user.cidade}, ${user.distrito}` : (user.cidade || 'N/A');
            
            // Informa√ß√µes extras para cuidadores
            let infoCuidador = '';
            if (tipo === 'cuidador') {
                const temPerfil = user.valorHora || user.areasAtuacao || user.qualificacoes || user.fotoPerfil;
                if (temPerfil) {
                    infoCuidador = '<div style="background: #e8f8f8; padding: 1rem; border-radius: 8px; margin-top: 1rem;">';
                    infoCuidador += '<strong style="color: #3abebd;">Perfil Profissional:</strong><br>';
                    
                    if (user.valorHora) {
                        infoCuidador += `üí∞ <strong>‚Ç¨${user.valorHora}/hora</strong><br>`;
                    }
                    if (user.experiencia) {
                        infoCuidador += `‚è±Ô∏è ${user.experiencia} anos de experi√™ncia<br>`;
                    }
                    if (user.areasAtuacao && user.areasAtuacao.length > 0) {
                        infoCuidador += `üìç Atende em: ${user.areasAtuacao.slice(0, 3).join(', ')}${user.areasAtuacao.length > 3 ? '...' : ''}<br>`;
                    }
                    if (user.qualificacoes && user.qualificacoes.length > 0) {
                        infoCuidador += `üéì ${user.qualificacoes.length} qualifica√ß√£o(√µes)<br>`;
                    }
                    if (user.disponibilidade && user.disponibilidade.length > 0) {
                        infoCuidador += `üìÖ Dispon√≠vel ${user.disponibilidade.length} dia(s)/semana`;
                    }
                    
                    infoCuidador += '</div>';
                } else {
                    infoCuidador = '<div style="background: #fff3cd; padding: 0.75rem; border-radius: 8px; margin-top: 1rem; color: #856404;">';
                    infoCuidador += '‚ö†Ô∏è Perfil profissional incompleto';
                    infoCuidador += '</div>';
                }
            }
            
            return `
                <div class="user-card ${tipo}-card">
                    <div class="user-header">
                        <div class="user-name">
                            ${user.fotoPerfil && tipo === 'cuidador' ? 
                                `<img src="${user.fotoPerfil}" alt="${user.nome}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin-right: 0.5rem; vertical-align: middle;">` : 
                                ''}
                            ${user.nome}
                        </div>
                        ${badges[tipo]}
                    </div>
                    <div class="user-info">
                        <div class="info-item">
                            <span>üìß</span>
                            <span>${user.email}</span>
                        </div>
                        <div class="info-item">
                            <span>üì±</span>
                            <span>${user.telefone || 'N/A'}</span>
                        </div>
                        <div class="info-item">
                            <span>üìç</span>
                            <span>${cidadeCompleta}</span>
                        </div>
                        <div class="info-item">
                            <span>üìÖ</span>
                            <span>Cadastro: ${dataFormatada}</span>
                        </div>
                        ${user.isActive !== undefined ? `
                        <div class="info-item">
                            <span>${user.isActive ? 'üü¢' : 'üî¥'}</span>
                            <span>${user.isActive ? 'Ativo' : 'Inativo'}</span>
                        </div>
                        ` : ''}
                    </div>
                    ${infoCuidador}
                    <div class="user-actions">
                        <button class="btn-action btn-view" onclick="verDetalhes('${user.id}')">
                            üëÅÔ∏è Ver Detalhes
                        </button>
                        <button class="btn-action btn-edit" onclick="editarUsuario('${user.id}')">
                            ‚úèÔ∏è Editar
                        </button>
                        ${user.role !== 'admin' && user.userType !== 'admin' ? `
                        <button class="btn-action btn-disable" onclick="toggleUsuario('${user.id}', ${user.isActive || false})">
                            ${user.isActive ? 'üö´ Desativar' : '‚úÖ Ativar'}
                        </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        /**
         * Ver detalhes do usu√°rio
         */
        function verDetalhes(userId) {
            const users = JSON.parse(localStorage.getItem('allUsers') || '[]');
            const user = users.find(u => u.id === userId);
            
            if (user) {
                const detalhes = JSON.stringify(user, null, 2);
                alert(`Detalhes do Usu√°rio:\n\n${detalhes}`);
                console.log('Detalhes completos:', user);
            }
        }
        
        /**
         * Editar usu√°rio (em desenvolvimento)
         */
        function editarUsuario(userId) {
            alert('üî® Funcionalidade de edi√ß√£o em desenvolvimento!\n\nEm breve voc√™ poder√° editar:\n- Dados cadastrais\n- Permiss√µes\n- Status');
        }
        
        /**
         * Ativar/Desativar usu√°rio (em desenvolvimento)
         */
        function toggleUsuario(userId, isActive) {
            const acao = isActive ? 'desativar' : 'ativar';
            if (confirm(`Tem certeza que deseja ${acao} este usu√°rio?`)) {
                alert(`üî® Funcionalidade em desenvolvimento!\n\nEm breve voc√™ poder√° ${acao} usu√°rios.`);
            }
        }
        
        // Carrega usu√°rios ao iniciar
        window.addEventListener('load', () => {
            carregarUsuarios();
        });
    </script>
</body>
</html>

